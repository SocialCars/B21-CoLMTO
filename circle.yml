general:
    branches:
        only:
            - master
        ignore:
            - develop
            - /dev-.*/
            - /gh-.*/
            - /sim-.*/

machine:
    timezone:
        Europe/Berlin

    environment:
        GIT_AUTHOR_NAME: CircleCI
        GIT_AUTHOR_EMAIL: masc@tu-clausthal.de
        GIT_COMMITTER_NAME: CircleCI
        GIT_COMMITTER_EMAIL: masc@tu-clausthal.de
        SUMO_HOME: ~/optom/sumo/sumo

    python:
        version: 2.7.12

dependencies:
    pre:
        - sudo apt-get install libhdf5-dev
        - pip install pylint

checkout:
  post:
    - git submodule sync
    - git submodule update --init

test:
    override:
        - git checkout master
        - mv -f optom /tmp
        - git checkout gh-pages
        - mv -f circle.yml /tmp
        - mv -f .gitignore /tmp
        - git checkout master
        - git push origin :gh-pages
        - git branch -D gh-pages
        - git checkout --orphan gh-pages
        - rm -Rf *
        - mv -f /tmp/.gitignore .
        - mv -f /tmp/circle.yml .
        - pylint optom -f html > pylint.html
        - git add --all .
        - git commit -m "current pylint run"
        - git push origin gh-pages
